apiVersion: v1
kind: ConfigMap
metadata:
  name: fleet-controller
data:
  config: |
    {
      "agentImage": "{{ template "system_default_registry" . }}{{.Values.agentImage.repository}}:{{.Values.agentImage.tag}}",
      "agentImagePullPolicy": "{{ .Values.agentImage.imagePullPolicy }}",
      "apiServerURL": "{{.Values.apiServerURL}}",
      "apiServerCA": "{{b64enc .Values.apiServerCA}}",
      "agentCheckinInterval": "{{.Values.agentCheckinInterval}}",
      "ignoreClusterRegistrationLabels": {{.Values.ignoreClusterRegistrationLabels}},
      "bootstrap": {
        "paths": "{{.Values.bootstrap.paths}}",
        "repo": "{{.Values.bootstrap.repo}}",
        "secret": "{{.Values.bootstrap.secret}}",
        "branch":  "{{.Values.bootstrap.branch}}",
        "namespace": "{{.Values.bootstrap.namespace}}"
      },
      "webhookReceiverURL": "{{.Values.webhookReceiverURL}}",
      "env": {
      {{- if .Values.env }}
        {{- range $k,$v := .Values.env }}
          "{{ $k }}": "{{ $v }}",
        {{- end }}
      {{- end }}
          "VALS_ENABLED": "{{ .Values.vals.enabled }}"
      },
      {{- if .Values.secret }}
      "secret": "{{ .Values.secret }}",
      {{- end }}
      {{- if .Values.agentSecret }}
      "agentSecret": "{{ .Values.agentSecret }}",
      {{- end }}
      "githubURLPrefix": "{{.Values.githubURLPrefix}}"
    }
